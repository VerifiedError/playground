@tailwind base;
@tailwind components;
@tailwind utilities;

/* Accessibility Utilities */
@layer utilities {
  /* Screen reader only text (hidden visually but accessible to assistive technologies) */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  /* Make screen reader only text visible when focused (for skip links) */
  .sr-only-focusable:focus {
    position: static;
    width: auto;
    height: auto;
    padding: 0.5rem 1rem;
    margin: 0;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }

  /* Fade-in animation for chat messages */
  .animate-fadeIn {
    animation: fadeIn 0.3s ease-out;
  }
}

/* PWA Mobile-First Styles */
@layer base {
  /* Prevent pull-to-refresh and overscroll on mobile */
  html {
    overscroll-behavior-y: none;
    -webkit-overflow-scrolling: touch;
    width: 100%;
    height: 100%;
    height: 100vh;
    height: 100dvh; /* Dynamic viewport height for mobile */
  }

  body {
    overscroll-behavior-y: none;
    -webkit-overflow-scrolling: touch;
    overflow-y: hidden; /* Prevent body scroll but allow internal scrolling */
    width: 100%;
    height: 100%;
    height: 100vh;
    height: 100dvh;
  }

  /* Ensure main app container fills screen */
  #__next {
    height: 100%;
    overflow: hidden;
  }
}

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 262 83% 58%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 262 83% 58%;
    --radius: 0.5rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 262 83% 58%;
    --primary-foreground: 210 40% 98%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 262 83% 58%;
  }
}

@layer base {
  * {
    border-color: hsl(var(--border));
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* Resizable Sidebar Styles */
@layer components {
  /* Smooth transitions for resize handle */
  [data-panel-resize-handle-id] {
    transition: background-color 0.15s ease;
  }

  /* Active state during dragging */
  [data-panel-resize-handle-id][data-resize-handle-active] {
    background-color: hsl(var(--primary)) !important;
  }

  /* Cursor change on resize handle */
  [data-panel-resize-handle-id] {
    cursor: col-resize !important;
  }

  /* Panel smooth transitions */
  [data-panel-id="sidebar"] {
    transition: flex-basis 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Prevent text selection during resize */
  [data-panel-resize-handle-id]:active,
  [data-panel-resize-handle-active] {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
  }

  /* Ensure proper layout during resize */
  [data-panel-group] {
    overflow: hidden;
  }

  /* Hide scrollbar but keep functionality (for pill buttons) */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;  /* Chrome, Safari and Opera */
  }

  /* Reasoning Display Animations */

  /* Card entrance animation */
  .reasoning-card-animate {
    animation: reasoning-card-enter 0.3s ease-out forwards;
    opacity: 0;
    transform: translateY(10px);
  }

  @keyframes reasoning-card-enter {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Streaming card border gradient animation */
  .reasoning-card-streaming {
    position: relative;
    background: linear-gradient(to bottom right, hsl(var(--card)), hsl(var(--muted)));
    border: 2px solid transparent;
    background-clip: padding-box;
  }

  .reasoning-card-streaming::before {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: inherit;
    background: linear-gradient(90deg, #a855f7, #3b82f6, #a855f7);
    background-size: 200% 100%;
    z-index: -1;
    animation: reasoning-gradient-flow 2s linear infinite;
  }

  @keyframes reasoning-gradient-flow {
    0% {
      background-position: 0% 50%;
    }
    100% {
      background-position: 200% 50%;
    }
  }

  /* Content fade-in for streaming cards */
  .reasoning-card-content-streaming {
    animation: reasoning-content-fade 0.3s ease-in;
  }

  @keyframes reasoning-content-fade {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* Progress bar animation */
  @keyframes reasoning-pulse-progress {
    0%, 100% {
      transform: translateX(-100%);
    }
    50% {
      transform: translateX(0%);
    }
  }

  .animate-pulse-progress {
    animation: reasoning-pulse-progress 2s ease-in-out infinite;
  }

  /* Completed card subtle pulse */
  .reasoning-card-complete {
    animation: reasoning-complete-pulse 0.5s ease-out;
  }

  @keyframes reasoning-complete-pulse {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.01);
    }
    100% {
      transform: scale(1);
    }
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    .reasoning-card-animate,
    .reasoning-card-streaming,
    .reasoning-card-content-streaming,
    .reasoning-card-complete {
      animation: none;
      opacity: 1;
      transform: none;
    }

    .reasoning-card-streaming::before {
      animation: none;
    }

    .animate-pulse-progress {
      animation: none;
    }
  }

  /* Mobile responsive adjustments */
  @media (max-width: 640px) {
    .reasoning-display {
      margin-left: 0;
      margin-right: 0;
      border-radius: 0.75rem;
    }

    .reasoning-card {
      font-size: 0.875rem;
    }
  }
}

/* Login Page Styles */
@layer components {
  /* Prevent zoom on input focus (mobile) */
  @media (max-width: 1023px) {
    input[type='text'],
    input[type='password'],
    input[type='email'],
    select,
    textarea {
      font-size: 16px !important;
    }
  }

  /* Touch-friendly inputs (mobile) */
  @media (max-width: 767px) {
    input[type='text'],
    input[type='password'] {
      min-height: 44px;
    }

    button {
      min-height: 44px;
    }
  }

  /* Login page animations */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .login-form {
    animation: fadeIn 0.5s ease-out;
  }

  /* Focus states */
  input:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: 2px;
  }

  /* Password toggle button */
  .password-toggle {
    transition: color 0.2s ease;
  }

  .password-toggle:hover {
    color: hsl(var(--primary));
  }

  /* Login button gradient */
  .login-button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transition: all 0.3s ease;
  }

  .login-button:hover:not(:disabled) {
    background: linear-gradient(135deg, #5568d3 0%, #663a8c 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  .login-button:active:not(:disabled) {
    transform: translateY(0);
  }

  .login-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

/* Mobile Optimizations */
@layer components {
  /* Safe area insets for iOS notch/Dynamic Island */
  .safe-bottom {
    padding-bottom: max(env(safe-area-inset-bottom), 0.75rem);
  }

  .safe-top {
    padding-top: max(env(safe-area-inset-top), 0.75rem);
  }

  /* Mobile Grid Layout for Chat */
  @media (max-width: 1023px) {
    .mobile-chat-container {
      display: grid;
      grid-template-rows: auto 1fr auto;
      grid-template-areas:
        "header"
        "messages"
        "input";
      height: 100dvh;
      height: 100vh;
      overflow: hidden;
    }

    .mobile-chat-header {
      grid-area: header;
    }

    .mobile-chat-messages {
      grid-area: messages;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
    }

    .mobile-chat-input {
      grid-area: input;
      /* Add extra padding for BottomNav: 72px nav + 20px safe area */
      padding-bottom: calc(72px + env(safe-area-inset-bottom, 20px));
    }
  }

  /* Prevent horizontal overflow on mobile */
  @media (max-width: 1023px) {
    body {
      overflow-x: hidden;
    }

    /* Touch-friendly scrolling */
    .overflow-y-auto {
      -webkit-overflow-scrolling: touch;
    }

    /* Prevent text size adjustment on orientation change */
    html {
      -webkit-text-size-adjust: 100%;
    }

    /* Better tap highlighting */
    * {
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
    }

    /* Disable double-tap zoom */
    button,
    a {
      touch-action: manipulation;
    }
  }

  /* Mobile prose adjustments */
  @media (max-width: 767px) {
    .prose {
      font-size: 0.875rem;
      line-height: 1.5;
    }

    .prose h1 {
      font-size: 1.5rem;
    }

    .prose h2 {
      font-size: 1.25rem;
    }

    .prose h3 {
      font-size: 1.125rem;
    }

    .prose code {
      font-size: 0.8125rem;
    }

    .prose pre {
      font-size: 0.75rem;
      padding: 0.75rem;
    }
  }
}

/* Analytics Mobile Tabs - Swipe Gestures */
@layer components {
  /* Smooth tab transitions */
  .analytics-tab-transition {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Tab content container */
  .analytics-tab-content {
    touch-action: pan-y; /* Allow vertical scrolling, horizontal for swipe */
    -webkit-user-select: none;
    user-select: none;
  }

  /* Safe area for analytics mobile view */
  .pb-safe {
    padding-bottom: max(env(safe-area-inset-bottom, 0px), 1rem);
  }

  /* Hide scrollbar for horizontal scrolling containers */
  .scrollbar-hide {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  /* Overscroll containment for tab content */
  .overscroll-y-contain {
    overscroll-behavior-y: contain;
  }

  /* Analytics stat cards tap feedback */
  @media (hover: none) and (pointer: coarse) {
    .stat-card-tap {
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      transition: transform 0.1s ease;
    }

    .stat-card-tap:active {
      transform: scale(0.98);
    }
  }
}

/* Responsive Modal Animations */
@layer components {
  /* Mobile: Slide up from bottom */
  @keyframes slide-up {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  /* Desktop: Fade in with subtle scale */
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .animate-slide-up {
    animation: slide-up 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .animate-fade-in {
    animation: fade-in 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .animate-slide-up,
    .animate-fade-in {
      animation: none;
      opacity: 1;
      transform: none;
    }
  }
}
